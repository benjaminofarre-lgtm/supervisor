<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surfland Manager 23.0 - Live Update</title>
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/2909/2909803.png">
    <style>
        :root { --primary: #0277bd; --secondary: #00838f; --accent: #f9a825; --bg: #f4f7f6; --text: #263238; --danger: #c62828; --success: #2e7d32; --locked: #9e9e9e; }
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 0; }
        
        #loadingMask { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        .loader { border: 5px solid #f3f3f3; border-top: 5px solid var(--primary); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        #loginScreen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; position: fixed; top: 0; left: 0; width: 100%; z-index: 1000; }
        .login-box { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 15px 35px rgba(0,0,0,0.3); text-align: center; width: 320px; color: var(--text); }
        .login-box input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #cfd8dc; border-radius: 6px; box-sizing: border-box; }
        .btn-login { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 16px; margin-top: 10px; }
        
        #appScreen { display: none; padding: 20px; max-width: 1200px; margin: 0 auto; padding-bottom: 80px; }
        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: white; padding: 15px 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .controls { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; flex-wrap: wrap; gap: 15px; align-items: center; margin-bottom: 20px; border-left: 5px solid var(--accent); }
        
        button { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; font-size: 1.1em; }
        .btn-secondary { background: #546e7a; color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-small-add { background: #e3f2fd; color: #0277bd; border: 1px dashed #0277bd; width: 100%; padding: 5px; margin-top: 5px; font-size: 0.9em; }
        .btn-small-add:hover { background: #bbdefb; }

        .schedule-container { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .team-banner { text-align: center; padding: 20px; color: white; font-size: 1.8em; font-weight: 800; text-transform: uppercase; letter-spacing: 2px; }
        .bg-kirra { background: linear-gradient(45deg, #1976d2, #42a5f5); }
        .bg-mundaka { background: linear-gradient(45deg, #388e3c, #66bb6a); }
        .bg-locked { background: #757575; }

        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px 15px; border-bottom: 1px solid #eee; text-align: left; vertical-align: middle; }
        th { background: #fafafa; color: #546e7a; font-size: 0.85em; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; }
        
        .editable-name { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 1em; }
        .status-select { padding: 6px; border-radius: 4px; font-weight: bold; width: 130px; }
        .status-fixo { background: #e8f5e9; color: #2e7d32; }
        .status-rotativo { background: #e3f2fd; color: #1565c0; }
        .status-free { background: #fff3e0; color: #ef6c00; }
        .role-guia { color: #0277bd; font-weight: 800; }
        .role-gv { color: #455a64; font-weight: 600; }
        .row-disabled { opacity: 0.6; background: #fafafa; }
        .check-status { transform: scale(1.3); cursor: pointer; accent-color: var(--success); }

        .panel { display: none; position: fixed; top: 0; right: 0; width: 850px; height: 100%; background: white; box-shadow: -5px 0 25px rgba(0,0,0,0.2); z-index: 100; overflow-y: auto; }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 99; }
        .panel-header { display: flex; justify-content: space-between; align-items: center; background: #f8f9fa; padding: 15px 20px; border-bottom: 1px solid #ddd; }
        .panel-content { padding: 20px; }

        .list-row { display: flex; align-items: center; margin-bottom: 8px; gap: 5px; }
        .list-row input { flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        .btn-trash { background: #ffebee; color: #c62828; border: 1px solid #ffcdd2; border-radius: 4px; padding: 5px 10px; cursor: pointer; }
        .config-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .config-section-title { font-weight: bold; color: var(--primary); margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 5px; display: block; }
        
        #lockedMessage { display: none; background: #ffebee; color: #c62828; padding: 10px; border-radius: 6px; margin-top: 10px; font-weight: bold; text-align: center; border: 1px solid #ffcdd2; }
    </style>
</head>
<body>

    <div id="loadingMask"><div class="loader"></div><h3 style="margin-top:20px; color:#555;">Carregando Surfland...</h3></div>

    <div id="loginScreen" style="display:none;">
        <div class="login-box">
            <h2 style="color:var(--primary); margin-bottom: 5px; letter-spacing: 1px;">SURFLAND</h2>
            <p style="margin-top:0; color:#777; font-size:0.9em;">Gest√£o de Escalas</p>
            <div id="loginError" style="color: #d32f2f; background:#ffebee; padding:10px; border-radius:4px; font-size: 0.9em; display: none; margin-bottom: 15px;">Login Incorreto</div>
            <input type="text" id="userInput" placeholder="Usu√°rio">
            <input type="password" id="passInput" placeholder="Senha">
            <button class="btn-login" type="button" onclick="window.attemptLogin()">ENTRAR (SUPERVISOR)</button>
            <button class="btn-login" style="background:#546e7a; margin-top:10px;" type="button" onclick="window.staffLogin()">Acesso Equipe</button>
        </div>
    </div>

    <div id="appScreen">
        <div class="header-bar">
            <div style="display:flex; align-items:center; gap:10px;">
                <h2 id="pageTitle" style="margin:0; color:var(--primary);">Organizador</h2>
                <span id="userBadge" style="padding:4px 8px; border-radius:4px; font-weight:bold; font-size:0.8em;"></span>
            </div>
            <span class="logout-link" onclick="location.reload()" style="cursor:pointer; color:red;">Sair</span>
        </div>

        <div class="controls">
            <div style="flex-grow: 1;">
                <label style="font-weight:bold; margin-right: 10px; color: var(--text);">üìÖ Data:</label>
                <input type="date" id="datePicker" onchange="window.changeDate()" style="padding: 10px; border-radius: 6px; border: 1px solid #ccc; font-family:inherit; font-size: 1rem;">
                <div id="lockedMessage">üîí DATA PASSADA - APENAS LEITURA</div>
            </div>

            <div id="adminControls" style="display:none; gap: 10px;">
                <button id="btnSave" class="btn-success" onclick="window.saveCurrentDay()">üíæ SALVAR ESCALA</button>
                <button class="btn-secondary" onclick="window.openPanel('configPanel')">‚öôÔ∏è Configurar Times</button>
            </div>
        </div>

        <div class="schedule-container">
            <div id="teamBanner" class="team-banner">...</div>
            <table id="scheduleTable">
                <thead>
                    <tr><th width="40">OK</th><th width="150">Fun√ß√£o</th><th>Colaborador</th><th width="140">Status</th></tr>
                </thead>
                <tbody id="scheduleBody"></tbody>
            </table>
        </div>
    </div>

    <div class="overlay" id="overlay" onclick="window.closeAllPanels()"></div>
    
    <div id="configPanel" class="panel">
        <div class="panel-header"><h3>üë• Configura√ß√£o de Times</h3><button onclick="window.closeAllPanels()">√ó</button></div>
        <div class="panel-content">
            <button class="btn-success" style="width:100%; margin-bottom:20px;" onclick="window.saveConfigToFirebase()">üíæ SALVAR E ATUALIZAR TELA</button>
            <div class="config-grid">
                <div>
                    <h3 style="color:var(--primary); margin:0;">üîµ KIRRA</h3>
                    <br><span class="config-section-title">Guias FIXOS</span><div id="listKirraGuides"></div>
                    <br><span class="config-section-title">GVs FIXOS</span><div id="listKirraGVs"></div>
                    <br><span class="config-section-title">ROTATIVOS</span><div id="listKirraRot"></div>
                </div>
                <div>
                    <h3 style="color:var(--success); margin:0;">üü¢ MUNDAKA</h3>
                    <br><span class="config-section-title">Guias FIXOS</span><div id="listMundakaGuides"></div>
                    <br><span class="config-section-title">GVs FIXOS</span><div id="listMundakaGVs"></div>
                    <br><span class="config-section-title">ROTATIVOS</span><div id="listMundakaRot"></div>
                </div>
            </div>
            <hr><h4 class="config-section-title">üü† Freelancers (Banco)</h4>
            <div id="listFreelancers" style="display:flex; flex-wrap:wrap; gap:10px;"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // ============================================
        // ‚ö†Ô∏è CONFIGURA√á√ÉO REAL CONECTADA ‚ö†Ô∏è
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyAF1d4Uk8-cg4vXwbHLmtg_Kzg6bvCYqaU",
            authDomain: "programa-de-escalas.firebaseapp.com",
            projectId: "programa-de-escalas",
            storageBucket: "programa-de-escalas.firebasestorage.app",
            messagingSenderId: "693139321340",
            appId: "1:693139321340:web:55d3b0f4af39ccf6078279"
        };
        // ============================================

        function getDefaultData() {
            return {
                kirraGuides: ["Guia K1", "Guia K2"], kirraGVs: ["GV K1", "GV K2"], kirraRot: ["Rot K1", "Rot K2"], 
                mundakaGuides: ["Guia M1", "Guia M2"], mundakaGVs: ["GV M1", "GV M2"], mundakaRot: ["Rot M1", "Rot M2"], 
                freelancers: ["Free 1", "Free 2"]
            };
        }

        let appConfig = getDefaultData(); 
        let currentDayData = [];
        let isAdmin = false;
        let isLocked = false;
        const BASE_DATE = new Date(2026, 0, 4); 
        const START_DATE_LIMIT = new Date(2026, 0, 6); // 06 de Janeiro de 2026
        let db;

        window.addEventListener('load', async () => {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            document.getElementById('datePicker').value = `${yyyy}-${mm}-${dd}`;

            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                
                const docRef = doc(db, "settings", "teams");
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    appConfig = docSnap.data();
                }
            } catch (e) {
                console.warn("Modo Offline ou Erro Config: ", e);
            }
            
            document.getElementById('loadingMask').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'flex';
            window.changeDate(); 
        });

        window.attemptLogin = function() {
            const u = document.getElementById('userInput').value;
            const p = document.getElementById('passInput').value;
            if(u === "SUPERVISORSURFLAND" && p === "meupapitobenja") {
                isAdmin = true;
                showApp();
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        };

        window.staffLogin = function() { isAdmin = false; showApp(); };

        function showApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('appScreen').style.display = 'block';
            const badge = document.getElementById('userBadge');
            const title = document.getElementById('pageTitle');
            if(isAdmin) {
                title.textContent = "Organizador";
                badge.textContent = "SUPERVISOR"; badge.style.backgroundColor = "#e8f5e9"; badge.style.color = "#2e7d32";
                document.getElementById('adminControls').style.display = 'flex';
            } else {
                title.textContent = "GUARDA-VIDAS SURFLAND";
                badge.textContent = "VISUALIZA√á√ÉO"; badge.style.backgroundColor = "#fff3e0"; badge.style.color = "#ef6c00";
            }
            window.changeDate();
        }

        window.changeDate = async function() {
            const dateStr = document.getElementById('datePicker').value;
            if(!dateStr) return;

            const parts = dateStr.split('-');
            const selDate = new Date(parts[0], parts[1]-1, parts[2]);
            const today = new Date(); today.setHours(0,0,0,0);
            
            if (selDate < START_DATE_LIMIT) {
                currentDayData = [];
                renderTable([], dateStr);
                document.getElementById('teamBanner').textContent = "AGUARDANDO IN√çCIO (06/01)";
                document.getElementById('teamBanner').className = "team-banner bg-locked";
                document.getElementById('lockedMessage').style.display = 'block';
                document.getElementById('lockedMessage').textContent = "üîí DADOS INDISPON√çVEIS ANTES DE 06/01/2026";
                if(document.getElementById('btnSave')) document.getElementById('btnSave').disabled = true;
                return;
            }

            isLocked = (selDate < today);
            document.getElementById('lockedMessage').style.display = isLocked ? 'block' : 'none';
            document.getElementById('lockedMessage').textContent = "üîí DATA PASSADA - APENAS LEITURA";
            if(document.getElementById('btnSave')) document.getElementById('btnSave').disabled = isLocked;

            currentDayData = generateMathSchedule(dateStr);
            renderTable(currentDayData, dateStr);

            if(db) {
                try {
                    const dayRef = doc(db, "days", dateStr);
                    const daySnap = await getDoc(dayRef);
                    if(daySnap.exists()) {
                        currentDayData = daySnap.data().entries;
                        renderTable(currentDayData, dateStr);
                    } else if(!isLocked && isAdmin) {
                        await setDoc(dayRef, { entries: currentDayData });
                    }
                } catch(e) { console.log("Offline mode"); }
            }
        };

        function generateMathSchedule(dateStr) {
            const parts = dateStr.split('-');
            const d = new Date(parts[0], parts[1]-1, parts[2]);
            const oneDay = 24 * 60 * 60 * 1000;
            const diffTime = Math.floor((d - BASE_DATE) / oneDay);
            
            const isKirra = (Math.abs(diffTime) % 2) === 0;
            const shiftIndex = Math.floor(Math.abs(diffTime) / 2);

            const listGuides = isKirra ? (appConfig.kirraGuides || []) : (appConfig.mundakaGuides || []);
            const listGVs = isKirra ? (appConfig.kirraGVs || []) : (appConfig.mundakaGVs || []);
            const listRot = isKirra ? (appConfig.kirraRot || []) : (appConfig.mundakaRot || []);
            const listFree = appConfig.freelancers || [];

            let schedule = [];
            
            // 1. TIME DE GUIAS
            let guidePool = [];
            listGuides.forEach(n => guidePool.push({name: n, status: "FIXO"}));
            
            const slotsNeed = 8 - guidePool.length;
            const rotOffsetGuides = (shiftIndex * slotsNeed) % Math.max(1, listRot.length);
            
            for(let i=0; i<slotsNeed; i++) {
                let idx = (rotOffsetGuides + i) % listRot.length;
                guidePool.push({name: listRot[idx], status: "ROTATIVO"});
            }
            
            guidePool = rotateArray(guidePool, shiftIndex);

            for(let i=0; i<8; i++) {
                if(i < guidePool.length) schedule.push({ role: `Guide ${i+1}`, name: guidePool[i].name, status: guidePool[i].status, active: true });
                else schedule.push({ role: `Guide ${i+1}`, name: "VAGA", status: "ROTATIVO", active: true });
            }

            // 2. TIME DE GVS
            let gvTotalPool = [];
            listGVs.forEach(n => gvTotalPool.push({name: n, status: "FIXO"}));
            
            const totalRot = listRot.length;
            const rotUsed = slotsNeed;
            const rotRemaining = totalRot - rotUsed;
            for(let i=0; i<rotRemaining; i++) {
                let idx = (rotOffsetGuides + rotUsed + i) % totalRot;
                gvTotalPool.push({name: listRot[idx], status: "ROTATIVO"});
            }

            const gvSoFar = gvTotalPool.length;
            const freeNeed = 12 - gvSoFar;
            if(freeNeed > 0) {
                const freeOffset = (Math.abs(diffTime) * freeNeed) % Math.max(1, listFree.length);
                for(let i=0; i<freeNeed; i++) {
                    let idx = (freeOffset + i) % listFree.length;
                    gvTotalPool.push({name: listFree[idx], status: "FREELANCER"});
                }
            }

            gvTotalPool = rotateArray(gvTotalPool, shiftIndex);

            for(let i=0; i<12; i++) {
                if(i < gvTotalPool.length) schedule.push({ role: `Guarda-Vidas ${i+1}`, name: gvTotalPool[i].name, status: gvTotalPool[i].status, active: true });
                else schedule.push({ role: `Guarda-Vidas ${i+1}`, name: "VAGA", status: "FREELANCER", active: true });
            }

            return schedule;
        }

        function rotateArray(arr, steps) {
            if(!arr.length) return [];
            const k = steps % arr.length;
            return arr.slice(arr.length - k).concat(arr.slice(0, arr.length - k));
        }

        function renderTable(data, dateStr) {
            const tbody = document.getElementById('scheduleBody');
            const banner = document.getElementById('teamBanner');
            tbody.innerHTML = "";
            
            if(data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="4" style="text-align:center; padding:30px; color:#aaa;">Sem escala dispon√≠vel</td></tr>`;
                return;
            }

            const parts = dateStr.split('-');
            const d = new Date(parts[0], parts[1]-1, parts[2]);
            const diff = Math.floor((d - BASE_DATE) / (1000 * 60 * 60 * 24));
            const isKirra = (Math.abs(diff) % 2) === 0;

            if(isLocked) { banner.textContent = "HIST√ìRICO BLOQUEADO"; banner.className = "team-banner bg-locked"; }
            else { banner.textContent = isKirra ? "Equipe: KIRRA" : "Equipe: MUNDAKA"; banner.className = isKirra ? "team-banner bg-kirra" : "team-banner bg-mundaka"; }

            data.forEach((entry, idx) => {
                const tr = document.createElement('tr');
                if(!entry.active) tr.classList.add('row-disabled');
                const disabled = isLocked ? "disabled" : "";
                
                const check = isAdmin ? `<input type="checkbox" class="check-status" ${entry.active?'checked':''} onchange="window.toggleActive(${idx})" ${disabled}>` : (entry.active ? '‚úÖ' : '‚ùå');
                const nameInput = isAdmin ? `<input class="editable-name" value="${entry.name}" onchange="window.editName(${idx}, this.value)" ${disabled}>` : `<b>${entry.name}</b>`;
                const select = isAdmin ? `<select class="status-select status-${entry.status.toLowerCase()}" onchange="window.editStatus(${idx}, this)" ${disabled}><option value="FIXO" ${entry.status=='FIXO'?'selected':''}>FIXO</option><option value="ROTATIVO" ${entry.status=='ROTATIVO'?'selected':''}>ROTATIVO</option><option value="FREELANCER" ${entry.status=='FREELANCER'?'selected':''}>FREELANCER</option></select>` : `<span style="font-weight:bold">${entry.status}</span>`;
                const roleClass = entry.role.includes("Guide") ? "role-guia" : "role-gv";
                tr.innerHTML = `<td>${check}</td><td class="${roleClass}">${entry.role}</td><td>${nameInput}</td><td>${select}</td>`;
                tbody.appendChild(tr);
            });
        }

        window.saveCurrentDay = async function() {
            if(!db) return alert("Erro: Firebase n√£o conectado.");
            const dateStr = document.getElementById('datePicker').value;
            if(!dateStr || isLocked) return;
            document.getElementById('loadingMask').style.display = 'flex';
            try {
                await setDoc(doc(db, "days", dateStr), { entries: currentDayData });
                alert("Salvo no Banco de Dados!");
            } catch(e) { alert("Erro ao salvar: " + e.message); }
            document.getElementById('loadingMask').style.display = 'none';
        };

        window.openPanel = async function(id) {
            document.getElementById('overlay').style.display = 'block';
            document.getElementById(id).style.display = 'block';
            if(id === 'configPanel') renderConfig();
        };

        window.closeAllPanels = function() { document.querySelectorAll('.panel').forEach(p=>p.style.display='none'); document.getElementById('overlay').style.display='none'; };
        window.toggleActive = (i) => { currentDayData[i].active = !currentDayData[i].active; };
        window.editName = (i, val) => { currentDayData[i].name = val; };
        window.editStatus = (i, el) => { currentDayData[i].status = el.value; el.className = "status-select status-" + el.value.toLowerCase(); };

        function renderConfig() {
            const keys = ['kirraGuides', 'kirraGVs', 'kirraRot', 'mundakaGuides', 'mundakaGVs', 'mundakaRot', 'freelancers'];
            
            keys.forEach(k => {
                const div = document.getElementById('list' + k.charAt(0).toUpperCase() + k.slice(1));
                if(div) {
                    let html = "";
                    const list = appConfig[k] || [];
                    list.forEach((val, i) => {
                        if(k === 'freelancers') {
                            html += `<div class="list-row" style="width:140px; display:inline-flex;">
                                            <input value="${val}" onchange="window.updateAppConfig('${k}', ${i}, this.value)" style="width:80px">
                                            <button class="btn-trash" onclick="window.removeItem('${k}', ${i})">üóëÔ∏è</button>
                                     </div>`;
                        } else {
                            html += `<div class="list-row">
                                            <input value="${val}" onchange="window.updateAppConfig('${k}', ${i}, this.value)">
                                            <button class="btn-trash" onclick="window.removeItem('${k}', ${i})">üóëÔ∏è</button>
                                     </div>`;
                        }
                    });
                    
                    const btnStyle = k === 'freelancers' ? "width:140px; margin:0;" : "width:100%;";
                    html += `<button type="button" class="btn-small-add" style="${btnStyle}" onclick="window.addItem('${k}')">+ Adicionar</button>`;
                    div.innerHTML = html;
                }
            });
        }

        window.updateAppConfig = (k, i, v) => { appConfig[k][i] = v; };
        window.addItem = (k) => { if(!appConfig[k]) appConfig[k]=[]; appConfig[k].push("Novo"); renderConfig(); };
        window.removeItem = (k, i) => { if(confirm("Apagar slot?")) { appConfig[k].splice(i, 1); renderConfig(); } };

        window.saveConfigToFirebase = async function() {
            if(!db) return alert("Firebase desconectado.");
            document.getElementById('loadingMask').style.display = 'flex';
            try {
                // 1. Salva a Configura√ß√£o Nova
                await setDoc(doc(db, "settings", "teams"), appConfig);
                
                // 2. Tenta atualizar a tela atual imediatamente
                const dateStr = document.getElementById('datePicker').value;
                if(dateStr && !isLocked) {
                    const selDate = new Date(dateStr);
                    if(selDate >= START_DATE_LIMIT) { 
                        // Regera a matem√°tica com os NOMES NOVOS
                        currentDayData = generateMathSchedule(dateStr); 
                        
                        // Atualiza no banco o dia atual com a nova escala
                        await setDoc(doc(db, "days", dateStr), { entries: currentDayData });
                        
                        // FOR√áA A ATUALIZA√á√ÉO VISUAL IMEDIATA
                        renderTable(currentDayData, dateStr);
                    }
                }
                alert("Configura√ß√µes Salvas e Tela Atualizada!");
                window.closeAllPanels();
            } catch(e) { alert("Erro: " + e.message); }
            document.getElementById('loadingMask').style.display = 'none';
        };
    </script>
</body>
</html>

